!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=43)}({43:function(e,t,n){e.exports=n("V51t")},V51t:function(e,t,n){"use strict";function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,o,r=[],c=!0,i=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(r.push(a.value),!t||r.length!==t);c=!0);}catch(e){i=!0,o=e}finally{try{c||null==n.return||n.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c,i,s,l,d,u,p,m,f,v,g,y,h,b,x,k,T,O,S,w,D,M,L,Y,A,j,P,E,R,C,N,I,K,F,J,H,z,G,B,q,X,V,Q,U=(l=document.getElementById("kt_calendar"),d=document.getElementById("kt_calendar_external_events"),u=[],p=$("#volunteers_depa_input"),m=$("#volunteers_restant_input"),f=$("#record_datetime"),v=$("#device_input"),g=$("#action_input"),y=$("#perform_input"),h=$(".row_rooms"),b=$("#eventTitle"),x=null,k=null,T=$("#recordDepaRooms"),O=$("#recordRestantRooms"),S=$("#btnDepaAdd"),w=$("#btnRestantAdd"),D=$("#depaExtra"),M=$("#restantExtra"),L=$("#depaRooms_remove"),Y=$("#restantRooms_remove"),A=$("#formRecordCalendar"),j=$("#btnRecordCalendar"),P=$("#btnColseModal"),E=$("#depaStatus"),R=$("#restantStatus"),p=$("#volunteers_depa_input"),m=$("#volunteers_restant_input"),C=$("#btnCalendarRecordPrint"),N={},I=[],K=function(e){var t=_.groupBy(e,(function(e){return moment(e.time).format("YYYY-MM-DD")})),n=[],o=[];_.each(t,(function(e,t){var a=(!1).ch_open,r=(!1).ch_close,c=(!1).p_open,i=(!1).p_close;n[t]=[],o[t]=!1,_.each(e,(function(e){n[t].push(e.action),0==e.action&&a&&(o[t]=!0),1==e.action&&r&&(o[t]=!0),2==e.action&&c&&(o[t]=!0),3==e.action&&i&&(o[t]=!0),a=0==e.action,r=1==e.action,c=2==e.action,i=3==e.action}))}));var r=!1,c=null;Object.entries(n).forEach((function(e){var t=a(e,2),n=t[0],o=t[1];0==o[0]&&1==o[o.length-1]||$('.fc-day[data-date="'+n+'"]').css("background","#ffffbc"),Object.entries(o).forEach((function(e){var t=a(e,2),n=(t[0],t[1]);0==n&&r&&$('.fc-day[data-date="'+c+'"]').css("background","#ff5959"),0==n&&(r=!0),1==n&&(r=!1)})),c=n})),Object.entries(o).forEach((function(e){var t=a(e,2),n=t[0];t[1]&&$('.fc-day[data-date="'+n+'"]').css("background","#ff5959")}))},F=function(e){return!0},J=function(e){var t="";switch(parseInt(e)){case 0:t="fc-event-primary";break;case 1:t="fc-event-danger";break;case 2:t="fc-event-success";break;case 3:t="fc-event-warning"}return t},H=function(e){if(s=e.id,$("#eventModal").modal("show",$(this)),b.html(current_employee.fullname),f.timepicker("setTime",moment(e.start).format("HH:mm:ss")),$("#record_id").val(e.id),v.val(e.extendedProps.device).change(),g.val(e.extendedProps.action).change(),y.val(e.extendedProps.perform).change(),1==e.extendedProps.action){var t=c.find((function(t){return t.id==e.id}));t&&q(t)}},z=function(){function e(e){e.class="tagify__tag tagify__tag-light--".concat(constants.colors[e.color]," status-").concat(e.status)}null===x&&null===k||(x.removeAllTags(),k.removeAllTags(),x.destroy(),k.destroy()),x=new Tagify(document.querySelector("#depaRooms"),{delimiters:null,editTags:!1,transformTag:e}),k=new Tagify(document.querySelector("#restantRooms"),{delimiters:null,editTags:!1,transformTag:e}),L.on("click",(function(){confirm(Lang.get("script.are_you_sure"))&&x.removeAllTags()})),Y.on("click",(function(){confirm(Lang.get("script.are_you_sure"))&&k.removeAllTags()})),$.ajax({url:"undefined"!=typeof current_record?"/records/rooms/".concat(current_record.id):"/records/rooms",type:"POST",cache:!1,datatype:"JSON",data:{date:moment(i.getEventById(s).start).format("YYYY-MM-DD"),calendar:!0,employee:current_employee.id},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e,t,n,a){var o="",r="";T.empty(),O.empty(),console.log(e),$.each(e,(function(e,t){o+='<optgroup label="'+constants.room_categories[e]+'">',r+='<optgroup label="'+constants.room_categories[e]+'">',$.each(t,(function(e,t){0==t.pivot.clean_type?o+='<option value="'+t.id+'">'+t.name+"</option>":r+='<option value="'+t.id+'">'+t.name+"</option>"})),o+="</optgroup>",r+="</optgroup>"})),T.append(o),O.append(r),T.selectpicker("refresh"),O.selectpicker("refresh")},error:function(e){var t="<b>"+String(e.responseJSON.message)+"</b><br>";for(var n in e.responseJSON.errors)e.responseJSON.errors.hasOwnProperty(n)&&(t+=e.responseJSON.errors[n]+"<br>");console.log(t)}})},G=function e(){var t=-10*Math.random();return-1===$.inArray(t,u)?(u.push(t),t):e()},B=function(e){KTApp.block(l),$.ajax({type:"PATCH",url:"/records/calendar/delete",datatype:"JSON",data:{record_id:e},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e,t,n){KTApp.unblock(l),i.removeAllEvents(),i.refetchEvents(),$(".fc-day").css("background","none");var a={};a.title=e.success,a.message="",$.notify(a,{type:"success",mouse_over:!0,z_index:1051}),$("#eventModal").modal("hide")},error:function(e,t,n){KTApp.unblock(l),console.log(e);var a={};a.title=e.responseJSON.message,a.message=$.map(e.responseJSON.errors,(function(e){return e})),$.notify(a,{type:"danger",mouse_over:!0,z_index:1051})}})},q=function(e){void 0!==e&&($.each(Object.values(e.rooms).filter((function(e){return 0==e.pivot.clean_type})),(function(e,t){x.addTags([{value:t.name,room_id:t.id,clean_type:t.pivot.clean_type,extra:t.pivot.extra,status:t.pivot.status,color:t.pivot.extra,volunteer:t.pivot.volunteer,title:X(t.pivot)}])})),$.each(Object.values(e.rooms).filter((function(e){return 1==e.pivot.clean_type})),(function(e,t){k.addTags([{value:t.name,room_id:t.id,clean_type:t.pivot.clean_type,extra:t.pivot.extra,status:t.pivot.status,color:t.pivot.extra,volunteer:t.pivot.volunteer,title:X(t.pivot)}])})))},X=function(e){var t="".concat(Lang.get("script.status"),": ").concat(constants.room_statuses[e.status]);return e.volunteer&&3==e.status&&(t+="\n".concat(Lang.get("script.volunteer"),": ").concat(e.volunteer_name)),t},V=function(e){$.map(e,(function(e){i.getEvents().filter((function(t){return moment(t.start).isSame(e.dita,"day")})).length||i.addEvent(r({title:"background event",start:e.dita,allDay:!0,rendering:"background",className:"record_calendar_plan ".concat(e.symbol," ").concat(constants.plan_colors[e.symbol].color)},"allDay",!0))}))},Q=function(){var e,t,n,a,o=moment(i.getDate()).format("MM"),r=null!==(e=null===(t=I[o])||void 0===t?void 0:t.reduce((function(e,t){return e+t}),0))&&void 0!==e?e:0,c=(r/36e5).toFixed(2),s=null!==(n=null===(a=I[o])||void 0===a?void 0:a.length)&&void 0!==n?n:0,l=s?(r/36e5/s).toFixed(2):0;$(".fc-toolbar .fc-center").find(".totalmonth").remove(),$(".fc-toolbar .fc-center").append('<div class="totalmonth md:block">\n          <span class="label label-inline label-pill mt-1 py-0 px-1">\n            <span class="mr-1">'.concat(Lang.get("script.total"),": <b>").concat(c,"h</b></span>\n            <span>").concat(Lang.get("script.average"),": <b>").concat(l,"h</b></span>\n          </span>\n        </div>"))},{init:function(){var e,t;$("#device_input","#action_input","#perform_input").select2({placeholder:"Select"}),1==g.find("option:selected").val()&&4!=v.find("option:selected").val()||(h.hide(),null===x&&null===k||(x.removeAllTags(),k.removeAllTags())),v.on("change",(function(e){4==v.find("option:selected").val()&&y.val(4).change(),1!=g.find("option:selected").val()||4==v.find("option:selected").val()?(h.hide(),null===x&&null===k||(x.removeAllTags(),k.removeAllTags())):(h.show(),z())})),g.on("change",(function(e){4!=v.find("option:selected").val()&&(1!=$(this).find("option:selected").val()?(h.hide(),null===x&&null===k||(x.removeAllTags(),k.removeAllTags())):(h.show(),z()))})),S.on("click",(function(e){x.addTags([{value:T.find("option:selected").text(),room_id:T.val(),extra:D.val(),color:D.val(),status:E.val(),volunteer:p.find(":selected").val(),title:X({status:E.val(),volunteer:m.find(":selected").val(),volunteer_name:m.select2("data")[0]?m.select2("data")[0].fullname:""})}])})),w.on("click",(function(e){k.addTags([{value:O.find("option:selected").text(),room_id:O.val(),extra:M.val(),color:M.val(),status:R.val(),volunteer:m.find(":selected").val(),title:X({status:R.val(),volunteer:m.find(":selected").val(),volunteer_name:m.select2("data")[0]?m.select2("data")[0].fullname:""})}])})),$("#kt_calendar_external_events .fc-draggable-handle").each((function(){$(this).data("event",{title:$.trim($(this).text()),stick:!0,classNames:[$(this).data("color")],startTime:$(this).data("hour"),extendedProps:{description:Lang.get("script.new_record"),hour:$(this).data("hour"),action:$(this).data("action"),device:$(this).data("device"),perform:$(this).data("perform"),identity:$(this).data("identity")}})})),t=moment().startOf("day").format("YYYY-MM-DD"),new(0,FullCalendarInteraction.Draggable)(d,{itemSelector:".fc-draggable-handle",eventData:function(e){return $(e).data("event").id=G(),$(e).data("event")}}),(i=new FullCalendar.Calendar(l,(r(e={plugins:["interaction","dayGrid","timeGrid","list"],eventTimeFormat:{hour:"2-digit",minute:"2-digit",meridiem:!1,hour12:!1},views:{timelineDay:{slotLabelFormat:["HH:mm"]},timelineMonth:{slotLabelFormat:["DD"]}},nextDayThreshold:"24:00:00",locale:Lang.locale,buttonText:{today:Lang.get("script.today"),month:Lang.get("script.month"),week:Lang.get("script.week"),day:Lang.get("script.day")},initialDate:moment().format("YYYY-MM-DD"),header:{left:"prev,next today",center:"title",right:""},height:800,contentHeight:780,aspectRatio:3,firstDay:1,nowIndicator:!0,now:new Date},"views",{dayGridMonth:{buttonText:"month"},timeGridWeek:{buttonText:"week"},timeGridDay:{buttonText:"day"},timeGrid:{eventLimit:2}}),r(e,"defaultView","dayGridMonth"),r(e,"defaultDate",t),r(e,"droppable",!0),r(e,"editable",!0),r(e,"eventLimit",!0),r(e,"navLinks",!0),r(e,"eventOrder","start"),r(e,"events",(function(e,t,n){$.ajax({url:"/records/calendar/".concat(current_employee.id,"/ajax"),type:"POST",cache:!1,datatype:"JSON",data:{start:e.start.valueOf(),end:e.end.valueOf()},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e,n,a,o){console.log(e.seconds),c=e.records,N={},I=[],t($.map(c,(function(e){return moment(e.time).format("YYYY-MM-DD")in N?N[moment(e.time).format("YYYY-MM-DD")].push({time:moment(e.time),action:e.action}):N[moment(e.time).format("YYYY-MM-DD")]=[{time:moment(e.time),action:e.action}],{id:e.id,title:constants.actions[e.action],start:e.time,end:null,className:J(e.action),editable:!1,extendedProps:{description:e.device.name,device:e.device.id,action:e.action,perform:e.perform,identity:e.identity}}}))),$(".totalday").remove();for(var r=0,i=Object.keys(e.seconds);r<i.length;r++){var s=i[r],l=moment(s).format("MM");if(l in I||(I[l]=[]),console.log(e.seconds[s]),I[l].push(e.seconds[s]),0!=e.seconds[s]){var d=(e.seconds[s]/3600).toFixed(2);$('.fc-day-top[data-date="'+s+'"]').append('<div class="totalday md:block">\n                            <span class="label label-sm label-inline label-pill mt-1 py-0 px-1">\n                              <span class="hidden sm:hidden md:block">'.concat(Lang.get("script.total"),":</span>\n                              <b>").concat(d,"h</b>\n                            </span>\n                          </div>"))}}K(c),V(e.plans),Q()},error:function(e){n(e)}})})),r(e,"loading",(function(e,t){e?KTApp.block(".fc-view-container"):KTApp.unblock(".fc-view-container")})),r(e,"eventClick",(function(e){e.jsEvent.srcElement.classList.contains("la-trash")||(H(e.event),console.log(e.event))})),r(e,"drop",(function(e){})),r(e,"eventReceive",(function(e){if(F(e.event))H(e.event);else{e.event.remove();var t={};t.title=Lang.get("script.not_allowed"),t.message="",$.notify(t,{type:"danger",mouse_over:!0,z_index:1051})}})),r(e,"datesRender",(function(e){"null"!=calendar_time&&i.gotoDate(calendar_time)})),r(e,"dayRender",(function(e,t){})),r(e,"eventRender",(function(e,t){if((t=$(e.el)).find(".fc-content").append('\n                <a href="#!" class="deleteEvent" data-id="'.concat(e.event.id,'">\n                  <span class="navi-icon">\n                      <i class="la la-trash hover:text-red-400"></i>\n                  </span>\n                </a>\n                ')),e.event.extendedProps&&e.event.extendedProps.description&&t.hasClass("fc-day-grid-event")){t.data("placement","right"),t.data("html",!0),t.data("title",Lang.get("script.record_summary"));var n='\n                        <div class="font-bold font-size-h6 text-center mb-2">'.concat(e.event.title,'</div>\n                        <div class="text-sm text-success">\n                          <span class="font-bold">').concat(Lang.get("script.time"),":</span> ").concat(moment(e.event.start).format("HH:mm"),'\n                        </div>\n                        <div class="text-sm">\n                          <span class="font-bold">').concat(Lang.get("script.device"),":</span> ").concat(e.event.extendedProps.description,'\n                        </div>\n                        <div class="text-sm">\n                          <span class="font-bold">').concat(Lang.get("script.action"),":</span> ").concat(constants.actions[e.event.extendedProps.action],'\n                        </div>\n                        <div class="text-sm">\n                          <span class="font-bold">').concat(Lang.get("script.perform"),":</span> ").concat(constants.performs[e.event.extendedProps.perform],'\n                        </div>\n                        <div class="text-sm">\n                          <span class="font-bold">').concat(Lang.get("script.identity"),":</span> ").concat(constants.identities[e.event.extendedProps.identity],"\n                        </div>\n                      ");if(1==e.event.extendedProps.action){var a=c.find((function(t){return t.id==e.event.id}));a&&(n+='\n                            <div class="separator separator-dashed my-1"></div>\n                            <div class="text-sm">\n                              <span class="font-bold">'.concat(Lang.get("script.depa"),":</span> ").concat(Object.values(a.rooms).filter((function(e){return 0==e.pivot.clean_type})).length,'\n                            </div>\n                            <div class="text-sm">\n                              <span class="font-bold">').concat(Lang.get("script.restant"),":</span> ").concat(Object.values(a.rooms).filter((function(e){return 1==e.pivot.clean_type})).length,"\n                            </div>\n                          "))}t.data("content",n),KTApp.initPopover(t)}})),r(e,"eventPositioned",(function(e){})),e))).render(),f.timepicker({minuteStep:1,defaultTime:"",showSeconds:!0,showMeridian:!1,snapToStep:!1,template:"dropdown"}),j.on("click",(function(e){e.preventDefault(),KTApp.block(".modal-content");var t=i.getEventById(s).start,n=moment(t).format("YYYY-MM-DD"),a=("0"+f.val()).slice(-8);$.ajax({type:"PATCH",url:A.attr("action"),data:A.serialize()+"&_day="+n+"&_time="+a,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e,t,n){console.log(e),KTApp.unblock(".modal-content"),i.removeAllEvents(),i.refetchEvents(),$(".fc-day").css("background","none");var a={};a.title=e.success,a.message="",$.notify(a,{type:"success",mouse_over:!0,z_index:1051}),$("#eventModal").modal("toggle"),p.val(null).trigger("change"),m.val(null).trigger("change")},error:function(e,t,n){KTApp.unblock(".modal-content"),console.log(e);var a={};a.title=e.responseJSON.message,a.message=$.map(e.responseJSON.errors,(function(e){return e})),$.notify(a,{type:"danger",mouse_over:!0,z_index:1051})}})})),P.on("click",(function(e){parseInt(s)<1&&i.getEventById(s).remove(),s=null,p.val(null).trigger("change"),m.val(null).trigger("change")})),$(l).on("click",".deleteEvent",(function(e){e.preventDefault(),confirm(Lang.get("script.are_you_sure"))&&B($(this).data("id"))})),$("#btnRecordDelete").on("click",(function(e){e.preventDefault(),confirm(Lang.get("script.are_you_sure"))&&B(s)})),C.on("click",(function(e){e.preventDefault(),window.location="/".concat(Lang.locale,"/records/calendar/").concat(current_employee.id,"/print?date=").concat(moment(i.getDate()).format("YYYY-MM"))})),function(){function e(e){if(e.loading)return e.id;var t=["success","info","primary","warning","danger"],n=void 0===t[e.function]?t[4]:t[e.function],a=0==e.function?Lang.get("script.Manager"):Lang.get("script.Employee");return'<div class="d-flex align-items-center">            <div class="symbol symbol-40 symbol-'.concat(n,' flex-shrink-0">              <div class="symbol-label">').concat(e.fullname.substring(0,1),'</div>            </div>            <div class="ml-2">              <div class="text-dark-75 font-weight-bold line-height-sm">').concat(e.fullname,'</div>              <span class="font-size-sm text-dark-50 text-hover-primary">').concat(a,"</span>            </div>          </div>")}function t(e){return e.fullname||e.text}p.select2({placeholder:Lang.get("script.search_employees"),allowClear:!0,ajax:{url:"/records/employees",dataType:"json",delay:250,data:function(e){return{query:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:30*t.page<e.total_count}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:0,templateResult:e,templateSelection:t}),m.select2({placeholder:Lang.get("script.search_employees"),allowClear:!0,ajax:{url:"/records/employees",dataType:"json",delay:250,data:function(e){return{query:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:30*t.page<e.total_count}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:0,templateResult:e,templateSelection:t}),m.trigger("change")}()}});jQuery(document).ready((function(){U.init()}))}});